!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Ab=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){(function(global,pool,math,width,chunks,digits,module,define,rngname){var startdenom=math.pow(width,chunks),significance=math.pow(2,digits),overflow=significance*2,mask=width-1,impl=math["seed"+rngname]=function(seed,use_entropy,callback){var key=[];var shortseed=mixkey(flatten(use_entropy?[seed,tostring(pool)]:seed==null?autoseed():seed,3),key);var arc4=new ARC4(key);mixkey(tostring(arc4.S),pool);return(callback||function(prng,seed,is_math_call){if(is_math_call){math[rngname]=prng;return seed}else return prng})(function(){var n=arc4.g(chunks),d=startdenom,x=0;while(n<significance){n=(n+x)*width;d*=width;x=arc4.g(1)}while(n>=overflow){n/=2;d/=2;x>>>=1}return(n+x)/d},shortseed,this==math)};function ARC4(key){var t,keylen=key.length,me=this,i=0,j=me.i=me.j=0,s=me.S=[];if(!keylen){key=[keylen++]}while(i<width){s[i]=i++}for(i=0;i<width;i++){s[i]=s[j=mask&j+key[i%keylen]+(t=s[i])];s[j]=t}(me.g=function(count){var t,r=0,i=me.i,j=me.j,s=me.S;while(count--){t=s[i=mask&i+1];r=r*width+s[mask&(s[i]=s[j=mask&j+t])+(s[j]=t)]}me.i=i;me.j=j;return r})(width)}function flatten(obj,depth){var result=[],typ=typeof obj,prop;if(depth&&typ=="object"){for(prop in obj){try{result.push(flatten(obj[prop],depth-1))}catch(e){}}}return result.length?result:typ=="string"?obj:obj+"\x00"}function mixkey(seed,key){var stringseed=seed+"",smear,j=0;while(j<stringseed.length){key[mask&j]=mask&(smear^=key[mask&j]*19)+stringseed.charCodeAt(j++)}return tostring(key)}function autoseed(seed){try{global.crypto.getRandomValues(seed=new Uint8Array(width));return tostring(seed)}catch(e){return[+new Date,global,(seed=global.navigator)&&seed.plugins,global.screen,tostring(pool)]}}function tostring(a){return String.fromCharCode.apply(0,a)}mixkey(math[rngname](),pool);if(module&&module.exports){module.exports=impl}else if(define&&define.amd){define(function(){return impl})}})(this,[],Math,256,6,52,typeof module=="object"&&module,typeof define=="function"&&define,"random")},{}],2:[function(_dereq_,module,exports){_dereq_("seedrandom");var Ab=function(profile,opts){"use strict";this.opts=opts||{};this.seed=this.opts.seed;this.profile=profile;this.storagePrefix+=profile.id;this.allocateId();if(!this.idValidator.test(this.profile.id)){throw new Error("Invalid test profile id")}if(!!this.opts.variant){this.addParticipation(this.profile.id,this.opts.variant)}return this};Ab.prototype.min=0;Ab.prototype.max=1e6;Ab.prototype.uidKey="ab__uid";Ab.prototype.seed=undefined;Ab.prototype.storagePrefix="ab__";Ab.prototype.profile={};Ab.prototype.isComplete=false;Ab.prototype.idValidator=/^[a-z0-9-]{1,10}$/;Ab.prototype.getParticipation=function(){"use strict";var db=localStorage.getItem(this.storagePrefix);return db?JSON.parse(db):{}};Ab.prototype.removeParticipation=function(){"use strict";return localStorage.removeItem(this.storagePrefix)};Ab.prototype.addParticipation=function(test,variantId){"use strict";localStorage.setItem(this.storagePrefix,JSON.stringify({id:test,variant:variantId}))};Ab.prototype.endParticipation=function(){"use strict";var t=this.getParticipation();t.complete=true;localStorage.setItem(this.storagePrefix,JSON.stringify(t))};Ab.prototype.hasExpired=function(){"use strict";return new Date>this.profile.expiry};Ab.prototype.clean=function(){"use strict";this.removeParticipation();return this};Ab.prototype.segment=function(){"use strict";var smallestTestId=this.max*this.profile.audienceOffset,largestTestId=smallestTestId+this.max*this.profile.audience;var allocateVariant=function(id,profile){return profile.variants[id%profile.variants.length].id};if(this.getParticipation().id===this.profile.id){return this}if(this.hasExpired()){return this}if(!this.profile.canRun.call(this)){return this}if(smallestTestId<=this.getId()&&largestTestId>this.getId()){var variant=allocateVariant(this.getId(),this.profile);this.addParticipation(this.profile.id,variant)}else{this.addParticipation(this.profile.id,"not-in-test")}return this};Ab.prototype.hasId=function(){"use strict";return!!localStorage.getItem(this.uidKey)};Ab.prototype.getId=function(){"use strict";return parseInt(localStorage.getItem(this.uidKey))};Ab.prototype.setId=function(n){"use strict";localStorage.setItem(this.uidKey,n);return n};Ab.prototype.allocateId=function(){"use strict";var generateRandomInteger=function(min,max,seed){var rng=seed?new Math.seedrandom(seed):Math.random;return Math.floor(rng()*(max-min+1)+min)};switch(this.hasId()){case true:return this.getId();default:return this.setId(generateRandomInteger(this.min,this.max,this.seed))}};Ab.prototype.run=function(){"use strict";var belongsTo=this.getParticipation().variant;this.profile.variants.forEach(function(v){if(v.id===belongsTo){v.test.call()}});return this};Ab.prototype.complete=function(){"use strict";this.isComplete=true;this.endParticipation();return this};module.exports=Ab},{seedrandom:1}]},{},[2])(2)});